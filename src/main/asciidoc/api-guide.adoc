= API Guide - HttpFS-Proxy
HttpFS-Proxy v{project-version} HELIX-GR;
:icons: font
:source-highlighter: highlightjs
:highlightjs-theme: github
:toc: left
:toclevels: 2
:sectlinks:

[[overview]]
== Overview

The `HttpFS-Proxy` service is an authenticating proxy in front of a HttpFS/HDFS service. It offers a REST API for manipulating 
files on an HDFS filesystem, simplifying the underlying `webhdfs` API exposed from the `HttpFS`/`HDFS` service.

It acts as a gateway service (similarly to the what `HttpFS` does) i.e. it does not require that the client has network 
access to the Hadoop cluster.

[[authentication]]
== Authentication

The API authenticates incoming requests using https://en.wikipedia.org/wiki/Basic_access_authentication[HTTP Basic Authentication] 
scheme. So, it expects an `Authorization` request header to be present in each request.

A simple example using `curl` and authenticating as user `someone` (proper headers will be added by `curl` because of the `-u` flag):
[source,bash]
----
curl -XGET -u someone -i 'https://httpfsproxy.example.net/files/status?path=temp/hello.txt'
----

Each proxy-level user maps to a Hadoop-level user, not necessarily with the same name. The proxy maintains the mapping between its users
and Hadoop-level users in order to be able to form proper requests to the underlying `webhdfs` API (e.g. for translating relative paths).

From now on, we will assume that all example requests are performed by a user `someone` mapping to a Hadoop-level user `user`.  


[[resources]]
== Resources

This section describes some common resources exchanged by the API.

[[resources-filestatus]]
=== File Status

An object that represents the status of a file/directory in a HDFS filesystem. Is a rough equivalent to the output 
of the `stat` command in a POSIX filesystem.

include::{snippets}/files-controller-tests/test-get-file-status-x1/response-fields-result-status.adoc[]



[[files]]
== Files API

This is an overview of the files API. All API endpoints, except `/f/home-directory`, require a `path` request parameter.

[cols=3*,options="header"]
|===
|Operation
|Request
|Details/Comments

|Get home directory
|`GET /f/home-directory`
|

|Get status of file/directory
|`GET /f/file/status`
|

|Get checksum of a file
|`GET /f/file/checksum`
|

|List a directory
|`GET /f/listing`
|List children of a directory (no recursion)

|Get content summary of a file/directory
|`GET /f/file/summary`
|

|Download a file
|`GET /f/file/content`
|Stream file content to the client

|Create a directory
|`PUT /f/directory`
|

|Rename a file/directory
|`PUT /f/name`
|

|Upload a file
|`PUT /f/file/content`
|Upload to create (or replace) content of target path

|Append to a file
|`POST /f/file/content`
|Upload to append content to a target path

|Concatenate sources into a file
|`POST /f/file/content`
|Do not upload, use existing file sources to be concatenated.

|Truncate a file
|`DELETE /f/file/content`
|

|Delete a file/directory
|`DELETE /f/file`
|

|Set permission for a file/directory
|`PUT /f/file/permission`
|_Not implemented yet_

|Set replication factor for a file
|`PUT /f/file/replication`
|_Not implemented yet_
|===


[[files-gethomedirectory]]
=== Get home directory
This is a `GET` request to `/f/home-directory`. 

==== The request parameters
No parameters

==== The response
The overall response is as follows:
include::{snippets}/files-controller-tests/test-get-home-directory/response-fields.adoc[]

The `result` part in detail:
include::{snippets}/files-controller-tests/test-get-home-directory/response-fields-result.adoc[]

==== A request/response example

include::{snippets}/files-controller-tests/test-get-home-directory/http-request.adoc[]
include::{snippets}/files-controller-tests/test-get-home-directory/http-response.adoc[]

==== A request example with CURL
include::{snippets}/files-controller-tests/test-get-home-directory/curl-request.adoc[]


[[files-status]]
=== Get status of a file/directory
This is a `GET` request to `/f/file/status`. 

==== The request parameters
It accepts the following request parameters:
include::{snippets}/files-controller-tests/test-get-file-status-x1/request-parameters.adoc[]

==== The response
The overall response is as follows:
include::{snippets}/files-controller-tests/test-get-file-status-x1/response-fields.adoc[]

The `result` part in detail:
include::{snippets}/files-controller-tests/test-get-file-status-x1/response-fields-result.adoc[]

==== A request/response example
A typical request/response exhange is the following (note that, for this kind of request, 
the result `pathSuffix` will always be empty):

include::{snippets}/files-controller-tests/test-get-file-status-x1/http-request.adoc[]
include::{snippets}/files-controller-tests/test-get-file-status-x1/http-response.adoc[]

==== A request example with CURL
include::{snippets}/files-controller-tests/test-get-file-status-x1/curl-request.adoc[]

==== Errors

_Todo_


[[files-filechecksum]]
=== Get checksum of a file
This is a `GET` request to `/f/file/checksum`. It returns a variation of an MD5 checksum as computed on the HDFS filesystem. 

==== The request parameters
It accepts the following request parameters:
include::{snippets}/files-controller-tests/test-get-file-checksum-x1/request-parameters.adoc[]

==== The response
The overall response is as follows:
include::{snippets}/files-controller-tests/test-get-file-checksum-x1/response-fields.adoc[]

The `result` part in detail:
include::{snippets}/files-controller-tests/test-get-file-checksum-x1/response-fields-result.adoc[]

==== A request/response example
A typical request/response exhange is as follows: 

include::{snippets}/files-controller-tests/test-get-file-checksum-x1/http-request.adoc[]
include::{snippets}/files-controller-tests/test-get-file-checksum-x1/http-response.adoc[]

==== A request example with CURL
include::{snippets}/files-controller-tests/test-get-file-checksum-x1/curl-request.adoc[]

==== Errors

_Todo_


[[files-liststatus]]
=== List a directory
This is a `GET` request to `/f/listing`. 

==== The request parameters
It accepts the following request parameters:
include::{snippets}/files-controller-tests/test-list-status/request-parameters.adoc[]

==== The response
The overall response is as follows:
include::{snippets}/files-controller-tests/test-list-status/response-fields.adoc[]

The `result` part in detail:
include::{snippets}/files-controller-tests/test-list-status/response-fields-result.adoc[]

==== A request/response example
A typical request/response exhange is the following (note that, for this kind of request, 
`pathSuffix` will always a non-empty file/directory name):

include::{snippets}/files-controller-tests/test-list-status/http-request.adoc[]
include::{snippets}/files-controller-tests/test-list-status/http-response.adoc[]

==== A request example with CURL
include::{snippets}/files-controller-tests/test-list-status/curl-request.adoc[]

==== Errors

_Todo_


[[files-contentsummary]]
=== Get content summary

_Todo_


[[files-mkdir]]
=== Create a directory

_Todo_


[[files-download]]
=== Download a file

_Todo_


[[files-rename]]
=== Rename a file/directory

_Todo_


[[files-upload]]
=== Upload a file

_Todo_


[[files-append]]
=== Append to a file

_Todo_


[[files-concatenate]]
=== Concatenate sources into a file

_Todo_


[[files-truncate]]
=== Truncate a file

_Todo_


[[files-delete]]
=== Delete a file/directory


[[files-permission]]
=== Set permission for a file/directory

_Todo_


[[files-replication]]
=== Set replication factor for a file

_Todo_

